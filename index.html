<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title> Äua Vá»‹t â€“ 20 ngÆ°á»i chÆ¡i | HTML 1 file</title>
  <style>
    :root{
      --bg: #0f172a;          /* slate-900 */
      --card:#111827ee;       /* gray-900 alpha */
      --muted:#94a3b8;        /* slate-400 */
      --text:#e5e7eb;         /* gray-200 */
      --accent:#22d3ee;       /* cyan-400 */
      --accent-2:#f472b6;     /* pink-400 */
      --win:#34d399;          /* emerald-400 */
      --warn:#fbbf24;         /* amber-400 */
      --danger:#fb7185;       /* rose-400 */
      --lane:#1f2937;         /* gray-800 */
      --finish:#fde047;       /* yellow-300 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(75rem 37.5rem at -10% -20%, #1e293b 0%, transparent 60%),
        radial-gradient(62.5rem 37.5rem at 110% 120%, #1e293b 0%, transparent 60%),
        linear-gradient(180deg, #0b1225, var(--bg));
      display:flex; flex-direction:column; gap:.875rem; padding:.75rem;
    }

    /* Header */
    .header{
      display:flex; gap:.75rem; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .title{
      display:flex; gap:.625rem; align-items:center;
      padding:.625rem .875rem; border-radius:1rem;
      background:linear-gradient(135deg,#0b1225,#0b1225 60%, #0f1a33);
      box-shadow: 0 .625rem 1.875rem #0006 inset, 0 .0625rem 0 #ffffff10;
    }
    .title h1{font-size:1.25rem; line-height:1.2; margin:0}
    .badge{
      padding:.125rem .625rem; border-radius:62.4375rem; font-weight:600; font-size:.75rem;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:#002b36;
    }

    /* Layout grid */
    .layout{
      display:grid; gap:.75rem;
      grid-template-columns: 1fr minmax(16.25rem, 21.25rem);
    }
    @media (max-width: 56.25rem){
      .layout{grid-template-columns: 1fr}
    }

    /* Control panel */
    .panel{
      background:linear-gradient(180deg,#0b1225,#0e152b);
      border:.0625rem solid #ffffff10;
      border-radius:1.125rem; padding:.75rem;
      box-shadow: 0 .625rem 1.875rem #0005;
      display:flex; flex-wrap:wrap; align-items:center; gap:.625rem;
    }
    .btn{
      appearance:none; border:none; cursor:pointer; user-select:none;
      font-weight:700; letter-spacing:.0125rem;
      padding:.625rem .875rem; border-radius:.75rem; transition:.2s transform, .2s filter, .2s opacity;
      background:#182036; color:var(--text); border:.0625rem solid #ffffff0f;
    }
    .btn:hover{filter:brightness(1.1)}
    .btn:active{transform:translateY(.0625rem) scale(.99)}
    .btn[disabled]{opacity:.55; cursor:not-allowed}
    .btn.start{background:linear-gradient(90deg,#0ea5e9,#22d3ee); color:#072b35}
    .btn.pause{background:linear-gradient(90deg,#f59e0b,#fbbf24); color:#3a2200}
    .btn.reset{background:linear-gradient(90deg,#fb7185,#f43f5e); color:#3a0010}
    .meta{margin-left:auto; display:flex; align-items:center; gap:.625rem; flex-wrap:wrap}
    .chip{
      border:.0625rem solid #ffffff15; background:#10172a; padding:.5rem .625rem; border-radius:.75rem; color:var(--muted); font-size:.75rem;
    }

    /* Tracks */
    .race-card{
      background:linear-gradient(180deg,#0b1225,#0b1225 55%,#0e1630);
      border:.0625rem solid #ffffff10; border-radius:1.125rem; padding:.625rem .625rem .875rem;
      box-shadow: 0 .625rem 1.875rem #0007;
    }
    .race-header{
      display:flex; align-items:center; justify-content:space-between; gap:.625rem; padding:.375rem .125rem .75rem;
    }
    .race-header h2{margin:0; font-size:1rem; color:#cbd5e1}
    .race-area{
      position:relative; width:100%; overflow:auto; padding:.625rem;
      border-radius:.75rem; background:linear-gradient(180deg,#0c1227,#0f162e);
      border:.0625rem dashed #ffffff14;
      max-height:68vh;
    }
    .track{
      position:relative; height:2.5rem; margin:.5rem 0; background:linear-gradient(90deg,#0f1a33,#0f1a33);
      border:.0625rem solid #ffffff0a; border-radius:62.4375rem; overflow:hidden;
    }
    .lane-bg{
      position:absolute; inset:0; background:
        repeating-linear-gradient(90deg, transparent 0 1.125rem, #ffffff06 1.125rem 1.1875rem);
      opacity:.25; pointer-events:none;
    }
    .finish-line{
      position:absolute; top:0; right:5rem; width:.25rem; height:100%;
      background: repeating-linear-gradient(
        0deg, var(--finish) 0 .375rem, #0000 .375rem .75rem
      );
      box-shadow: -0.375rem 0 .75rem #fde04730;
    }
    .duck{
      position:absolute; top:50%; transform:translateY(-50%);
      left:.625rem; display:flex; align-items:center; gap:.625rem;
      padding:.375rem .625rem; border-radius:62.4375rem; font-weight:800;
      background:linear-gradient(90deg,#111827,#0b1225); border:.0625rem solid #ffffff18;
      box-shadow: 0 .5rem 1.25rem #0008;
      white-space:nowrap;
    }
    .duck .emoji{font-size:1.25rem}
    .tag{
      font-size:.75rem; color:#cbd5e1; opacity:.85; background:#0b1020; padding:.125rem .5rem; border-radius:62.4375rem; border:.0625rem solid #ffffff12;
    }
    .rank-badge{
      position:absolute; right:-2.375rem; top:50%; transform:translateY(-50%);
      font-weight:900; font-size:.8125rem; color:#0b0f1a;
      background:linear-gradient(90deg,#34d399,#10b981);
      border:.0625rem solid #ffffff60; border-radius:62.4375rem; padding:.25rem .5rem;
      display:none;
    }
    .duck.finished .rank-badge{display:block}
    .duck.top1{outline:.125rem solid #fbbf24; box-shadow:0 0 0 .1875rem #fbbf2430, 0 .625rem 1.5rem #fbbf2433}
    .duck.top2{outline:.125rem solid #cbd5e1}
    .duck.top3{outline:.125rem solid #f59e0b55}

    /* Sidebar: Mission */
    .sidebar{
      background:linear-gradient(180deg,#0b1225,#0e152b);
      border:.0625rem solid #ffffff10; border-radius:1.125rem; padding:.75rem;
      box-shadow: 0 .625rem 1.875rem #0007;
      display:flex; flex-direction:column; gap:.625rem;
    }
    .sidebar h3{margin:0; font-size:1rem}
    .mission{
      background:#0a1122; border:.0625rem solid #ffffff10; border-radius:.75rem; padding:.625rem; color:#cbd5e1; line-height:1.5; font-size:.875rem;
    }
    .mission ul{margin:.5rem 0 0 1.125rem}
    .note{
      font-size:.75rem; color:var(--muted); margin-top:.25rem
    }

    /* Results table */
    .results{
      margin-top:.625rem; border:.0625rem solid #ffffff12; border-radius:.75rem; overflow:hidden
    }
    .results table{width:100%; border-collapse:collapse; font-size:.8125rem}
    .results th,.results td{padding:.5rem .625rem; text-align:left; border-bottom:.0625rem solid #ffffff0d}
    .results th{background:#0f1a33; color:#cbd5e1; position:sticky; top:0}
    .results tbody tr:nth-child(odd){background:#0b1225}
    .results tbody tr:nth-child(even){background:#0d1427}

    /* Modal podium */
    .modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:#0009; backdrop-filter: blur(.1875rem); z-index:50;
    }
    .modal.show{display:flex}
    .modal-card{
      width:min(42.5rem,92vw); border-radius:1.25rem; padding:1rem;
      background:linear-gradient(180deg,#0b1225,#0e152b);
      border:.0625rem solid #ffffff18; box-shadow:0 1.25rem 3.75rem #000c;
    }
    .modal-header{display:flex; align-items:center; gap:.625rem; justify-content:space-between; padding-bottom:.5rem}
    .close{background:#10172a; border:.0625rem solid #ffffff20; color:#cbd5e1}
    .podium{
      display:grid; grid-template-columns: repeat(3,1fr); gap:.625rem; margin-top:.625rem; align-items:end;
    }
    .podium .step{
      text-align:center; border-radius:1rem; padding:.75rem .5rem;
      background:linear-gradient(180deg,#0b1225,#0d1630); border:.0625rem solid #ffffff18;
    }
    .step h4{margin:.375rem 0 .125rem}
    .gold{box-shadow:0 0 0 .125rem #fbbf24; }
    .silver{box-shadow:0 0 0 .125rem #cbd5e1; }
    .bronze{box-shadow:0 0 0 .125rem #f59e0b; }
    .step .medal{font-size:1.5rem; display:block}
    .step .pid{font-size:.75rem; color:#a5b4fc}
    .step .time{font-size:.75rem; color:#93c5fd}

    /* Toast / live region */
    .sr{position:absolute; width:.0625rem; height:.0625rem; overflow:hidden; clip:rect(0 0 0 0)}
  </style>
</head>
<body>
  <div class="header">
    <div class="title">
      <span class="badge">HTML 1 file</span>
      <h1>ğŸ¤ Äua Vá»‹t â€“ 20 ngÆ°á»i chÆ¡i</h1>
    </div>
    <div class="panel" role="group" aria-label="Race controls">
      <button id="btnStart" class="btn start">â–¶ï¸ Báº¯t Ä‘áº§u cuá»™c Ä‘ua (Space)</button>
      <button id="btnPause" class="btn pause" disabled>â¸ï¸ Táº¡m dá»«ng</button>
      <button id="btnReset" class="btn reset">â™»ï¸ Äáº·t láº¡i (R)</button>
      <div class="meta">
        <span class="chip">â±ï¸ Thá»i gian: <strong id="time">0.00s</strong></span>
        <span class="chip">ğŸ Vá» Ä‘Ã­ch: <strong id="finishedCount">0/20</strong></span>
      </div>
    </div>
  </div>

  <div class="layout">
    <!-- MAIN: Race -->
    <section class="race-card" aria-labelledby="raceTitle">
      <div class="race-header">
        <h2 id="raceTitle">TrÆ°á»ng Ä‘ua vá»‹t</h2>
        <small class="note">Máº¹o: Nháº¥n <b>Space</b> Ä‘á»ƒ Báº¯t Ä‘áº§u/Táº¡m dá»«ng, <b>R</b> Ä‘á»ƒ Äáº·t láº¡i.</small>
      </div>
      <div id="raceArea" class="race-area">
        <div class="finish-line" aria-hidden="true"></div>
        <!-- Tracks will be injected here -->
      </div>

      <div class="results" aria-live="polite">
        <table>
          <thead>
            <tr><th style="width:4.375rem">Vá»‹ trÃ­</th><th style="width:5.625rem">ID</th><th>Ghi chÃº</th><th style="width:7.5rem">Thá»i gian</th></tr>
          </thead>
          <tbody id="resultsBody"><tr><td colspan="4" style="text-align:center;color:#94a3b8">ChÆ°a cÃ³ káº¿t quáº£. HÃ£y báº¯t Ä‘áº§u cuá»™c Ä‘ua!</td></tr></tbody>
        </table>
      </div>
    </section>

    <!-- SIDEBAR: Mission -->
    <aside class="sidebar">
      <h3>ğŸ§­ Mission â€¢ Thá»­ thÃ¡ch Ã¡p dá»¥ng AI 48h</h3>
      <div class="mission">
        <p><strong>Má»¥c tiÃªu:</strong> á»¨ng dá»¥ng AI Ä‘á»ƒ tÄƒng tá»‘c phÃ¡t triá»ƒn & trÃ¬nh diá»…n sáº£n pháº©m nhanh trong 48 giá».</p>
        <ul>
          <li>Chuyá»ƒn yÃªu cáº§u â†’ prototype cháº¡y Ä‘Æ°á»£c (nhÆ° trÃ² chÆ¡i nÃ y) trong 1 file.</li>
          <li>Tá»‘i Æ°u UI/UX Ä‘á»ƒ dá»… trÃ¬nh chiáº¿u trÃªn desktop & mobile.</li>
          <li>Ghi log káº¿t quáº£ (TOP 3), cÃ³ thá»ƒ dÃ¹ng lÃ m <em>demo data</em>.</li>
          <li>Má»Ÿ rá»™ng: thÃªm API giáº£ láº­p, lÆ°u localStorage, hoáº·c auto re-run.</li>
        </ul>
        <p class="note">Báº¡n cÃ³ thá»ƒ sá»­a trá»±c tiáº¿p ná»™i dung â€œMissionâ€ nÃ y Ä‘á»ƒ phÃ¹ há»£p vá»›i Ä‘á»™i cá»§a mÃ¬nh.</p>
      </div>
      <div class="mission">
        <p><strong>Ã tÆ°á»Ÿng nÃ¢ng cáº¥p nhanh:</strong></p>
        <ul>
          <li>ThÃªm seed Ä‘á»ƒ tÃ¡i hiá»‡n cÃ¹ng má»™t cuá»™c Ä‘ua.</li>
          <li>Xuáº¥t CSV thá»© tá»± vá» Ä‘Ã­ch.</li>
          <li>ThÃªm â€œcáº£n giÃ³â€, â€œtÄƒng tá»‘câ€ ngáº«u nhiÃªn theo tá»«ng cháº·ng.</li>
        </ul>
      </div>
    </aside>
  </div>

  <!-- Modal Podium -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="podiumTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="podiumTitle">ğŸ† TOP 3 ngÆ°á»i tháº¯ng cuá»™c</h3>
        <div style="display:flex; gap:.5rem">
          <button id="btnAgain" class="btn start">ğŸ” Cháº¡y láº¡i ngay</button>
          <button id="btnClose" class="btn close">ÄÃ³ng</button>
        </div>
      </div>
      <div class="podium">
        <div class="step silver" id="podium2">
          <span class="medal">ğŸ¥ˆ</span>
          <h4>Háº¡ng 2</h4>
          <div class="pid">ID: â€“</div>
          <div class="time">â€“ s</div>
        </div>
        <div class="step gold" id="podium1" style="transform:translateY(-0.625rem)">
          <span class="medal">ğŸ¥‡</span>
          <h4>Háº¡ng 1</h4>
          <div class="pid">ID: â€“</div>
          <div class="time">â€“ s</div>
        </div>
        <div class="step bronze" id="podium3">
          <span class="medal">ğŸ¥‰</span>
          <h4>Háº¡ng 3</h4>
          <div class="pid">ID: â€“</div>
          <div class="time">â€“ s</div>
        </div>
      </div>
      <div class="note" style="margin-top:.625rem">Máº¹o: Nháº¥n <b>R</b> Ä‘á»ƒ Ä‘áº·t láº¡i & cháº¡y lÆ°á»£t má»›i.</div>
    </div>
  </div>

  <!-- Live region for accessibility -->
  <div id="live" class="sr" aria-live="polite"></div>

  <script>
  (function(){
    const NUM_PLAYERS = 20;
    const EMOJIS = ["ğŸ¦†","ğŸ¥","ğŸ¤","ğŸª¿","ğŸ£", "ğŸ·", "ğŸ–", "ğŸ½"];
    const raceArea = document.getElementById('raceArea');
    const resultsBody = document.getElementById('resultsBody');
    const btnStart = document.getElementById('btnStart');
    const btnPause = document.getElementById('btnPause');
    const btnReset = document.getElementById('btnReset');
    const btnClose = document.getElementById('btnClose');
    const btnAgain = document.getElementById('btnAgain');
    const modal = document.getElementById('modal');
    const timeEl = document.getElementById('time');
    const finishedCountEl = document.getElementById('finishedCount');
    const live = document.getElementById('live');

    const podium1 = document.getElementById('podium1');
    const podium2 = document.getElementById('podium2');
    const podium3 = document.getElementById('podium3');

    let ducks = [];              // per duck: { id, el, badgeEl, x, vx, finished, rank }
    let running = false;
    let rafId = null;
    let startTs = 0;
    let pauseAccum = 0;
    let pauseStart = 0;
    let finishOrder = [];        // {id, time}

    // ---------- Helpers ----------
    const rand = (min, max) => Math.random() * (max - min) + min;
    const pick = arr => arr[Math.floor(Math.random() * arr.length)];
    function fmt(s){ return (Math.round(s*100)/100).toFixed(2) + 's'; }
    function announce(msg){ live.textContent = msg; }

    // Danh sÃ¡ch tÃªn vá»‹t
    const DUCK_NAMES = [
    "Vá»‹t Dáº¡ CÃ y",
    "Vá»‹t Overthinking",
    "Heo hay vá»‹t?ğŸ«¡",
    "Vá»‹t thÃ¬ pháº£i?ğŸ« ",
    "Heo thÃ¬ pháº£i?ğŸ˜",
    "Heo mÃ !ğŸ¤£",
    "Vá»‹t LÆ°á»i Biáº¿ng",
    "Vá»‹t Tá»‘c HÃ nh",
    "Vá»‹t ThÃ­ch Ngá»§",
    "Vá»‹t SiÃªu Tá»‘c",
    "Heo NgÃ¡o NgÆ¡",
    "Dá»£ SiÃªu Hua CuteeğŸ¥°",  // báº¯t buá»™c cÃ³
    "Chá»“nggg Chhin Hua CutoeeğŸ˜", // báº¯t buá»™c cÃ³
    "Vá»‹t Äáº¹p Trai",
    "Vá»‹t Dá»… ThÆ°Æ¡ng",
    "Vá»‹t Ham Ä‚n",
    "Vá»‹t ThÃ­ch Äi ChÆ¡i",
    "Vá»‹t CÆ°á»i TÆ°Æ¡i",
    "Vá»‹t HÃ i HÆ°á»›c",
    "Vá»‹t NghiÃªm TÃºc",
    "Vá»‹t Tinh Nghá»‹ch",
    "Vá»‹t HÆ¡i Láº§y",
    "Vá»‹t SiÃªu NhÃ¢y"
    ];

    // ---------- Build tracks ----------
    function buildTracks(){
    raceArea.innerHTML = '<div class="finish-line" aria-hidden="true"></div>';
    ducks = [];



    // Clone danh sÃ¡ch Ä‘á»ƒ random
    let namePool = [...DUCK_NAMES];
    while(namePool.length < NUM_PLAYERS){
        // náº¿u thiáº¿u tÃªn thÃ¬ random thÃªm tá»« danh sÃ¡ch gá»‘c
        namePool.push(duckNames[Math.floor(Math.random()*duckNames.length)]);
    }

    // Trá»™n thá»© tá»± tÃªn
    namePool = namePool.sort(() => Math.random() - 0.5);

    for(let i=1;i<=NUM_PLAYERS;i++){
        const track = document.createElement('div');
        track.className = 'track';
        track.setAttribute('role','group');
        track.setAttribute('aria-label',`ÄÆ°á»ng Ä‘ua cá»§a ${namePool[i-1]}`);

        const laneBg = document.createElement('div');
        laneBg.className = 'lane-bg';
        track.appendChild(laneBg);

        const duck = document.createElement('div');
        duck.className = 'duck';
        duck.style.left = '.625rem';

        const emoji = document.createElement('span');
        emoji.className = 'emoji';
        emoji.textContent = pick(EMOJIS);

        const label = document.createElement('span');
        label.className = 'tag';
        label.textContent = namePool[i-1]; // GÃ¡n tÃªn vá»‹t

        const rankBadge = document.createElement('span');
        rankBadge.className = 'rank-badge';
        rankBadge.textContent = '#?';

        duck.appendChild(emoji);
        duck.appendChild(label);
        duck.appendChild(rankBadge);
        track.appendChild(duck);
        raceArea.appendChild(track);

        label.textContent = DUCK_NAMES[i-1] || `Vá»‹t ${i}`;
            ducks.push({
            id: i,
            name: label.textContent, // lÆ°u tÃªn vá»‹t
            el: duck,
            badgeEl: rankBadge,
            x: 10,
            vx: rand(0.6, 1.1),
            finished: false,
            rank: null
        });
    }
    updateFinishedCount();
    resultsBody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:#94a3b8">Sáºµn sÃ ng! Nháº¥n <b>Báº¯t Ä‘áº§u</b> Ä‘á»ƒ thi Ä‘áº¥u.</td></tr>`;
    }

    // ---------- Race logic ----------
    function maxDistance(){
      const containerWidth = raceArea.clientWidth || raceArea.getBoundingClientRect().width;
      // right finish line is at right:5rem; duck width ~ 4.5rem; margin
      const safety = 80 + 72 + 20;
      return Math.max(120, containerWidth - safety);
    }

    function startRace(){
      if (running) return;
      running = true;
      btnStart.disabled = true;
      btnPause.disabled = false;

      const now = performance.now();
      if (startTs === 0){
        startTs = now; pauseAccum = 0;
      }else if (pauseStart){
        pauseAccum += (now - pauseStart);
        pauseStart = 0;
      }
      loop();
      announce('Cuá»™c Ä‘ua báº¯t Ä‘áº§u!');
    }
    function pauseRace(){
      if (!running) return;
      running = false;
      btnStart.disabled = false;
      btnPause.disabled = true;
      pauseStart = performance.now();
      if (rafId) cancelAnimationFrame(rafId);
      announce('ÄÃ£ táº¡m dá»«ng cuá»™c Ä‘ua.');
    }
    function resetRace(){
      if (rafId) cancelAnimationFrame(rafId);
      running = false;
      startTs = 0; pauseAccum = 0; pauseStart = 0;
      finishOrder = [];
      btnStart.disabled = false; btnPause.disabled = true;
      timeEl.textContent = '0.00s';
      hideModal();
      buildTracks();
      announce('ÄÃ£ Ä‘áº·t láº¡i cuá»™c Ä‘ua.');
    }

    function updateFinishedCount(){
      finishedCountEl.textContent = `${finishOrder.length}/${NUM_PLAYERS}`;
    }

    function loop(){
      const md = maxDistance();
      const tNow = performance.now();
      const elapsed = startTs ? (tNow - startTs - pauseAccum) / 1000 : 0;
      timeEl.textContent = fmt(elapsed);

      // Move each duck
      const allFinished = finishOrder.length === NUM_PLAYERS;
      if (!allFinished){
        ducks.forEach(d=>{
          if (d.finished) return;
          // small per-frame jitter
          const burst = (Math.sin(tNow/200 + d.id) + 1) * 0.25; // 0..0.5
          const randomness = rand(0.4, 1.0);
          const delta = (d.vx * randomness + burst) * 1.6; // tune here for pace
          d.x = Math.min(d.x + delta, 10 + md);
          d.el.style.left = d.x + 'px';
          if (d.x >= 10 + md){
            d.finished = true;
            const time = (performance.now() - startTs - pauseAccum)/1000;
            finishOrder.push({id:d.id, time});
            d.rank = finishOrder.length;
            d.el.classList.add('finished');
            d.badgeEl.textContent = '#' + d.rank;
            if (d.rank<=3) d.el.classList.add('top'+d.rank);
            updateResults();
            updateFinishedCount();
            if (d.rank<=3){
              announce(`Vá»‹t ${d.id} vá» Ä‘Ã­ch háº¡ng ${d.rank}`);
            }
            // Show podium when top 3 ready
            if (finishOrder.length === 3){
              setTimeout(showPodium, 200);
            }
          }
        });
      }

      if (running && finishOrder.length < NUM_PLAYERS){
        rafId = requestAnimationFrame(loop);
      }else if (finishOrder.length === NUM_PLAYERS){
        btnPause.disabled = true;
        btnStart.disabled = true;
      }
    }

    // ---------- Results & Podium ----------
    function updateResults(){
      if (finishOrder.length === 0){
        resultsBody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:#94a3b8">ChÆ°a cÃ³ káº¿t quáº£.</td></tr>`;
        return;
      }
      const rows = finishOrder.map((r, idx)=>{
        const note = idx<3 ? (idx===0?'ğŸ¥‡':idx===1?'ğŸ¥ˆ':'ğŸ¥‰')+' TOP' : '';
        const name = DUCK_NAMES[r.id-1];
        return `<tr>
          <td><b>#${idx+1}</b></td>
          <td>${name}</td>
          <td>${note}</td>
          <td>${fmt(r.time)}</td>
        </tr>`;
      }).join('');
      resultsBody.innerHTML = rows;
    }

    function showPodium(){
      const [p1,p2,p3] = finishOrder.slice(0,3);
      if (!p1 || !p2 || !p3) return;

      const name1 = DUCK_NAMES[p1.id-1];
      const name2 = DUCK_NAMES[p2.id-1];
      const name3 = DUCK_NAMES[p3.id-1];

      podium1.querySelector('.pid').textContent = `${name1}`;
      podium1.querySelector('.time').textContent = `${fmt(p1.time)}`;
      podium2.querySelector('.pid').textContent = `${name2}`;
      podium2.querySelector('.time').textContent = `${fmt(p2.time)}`;
      podium3.querySelector('.pid').textContent = `${name3}`;
      podium3.querySelector('.time').textContent = `${fmt(p3.time)}`;
      modal.classList.add('show');
    }
    function hideModal(){ modal.classList.remove('show'); }

    // ---------- Events ----------
    btnStart.addEventListener('click', startRace);
    btnPause.addEventListener('click', pauseRace);
    btnReset.addEventListener('click', resetRace);
    btnClose.addEventListener('click', hideModal);
    btnAgain.addEventListener('click', ()=>{ hideModal(); resetRace(); startRace(); });

    window.addEventListener('resize', () => {
      // Keep ducks within new bounds when resizing
      const md = maxDistance();
      ducks.forEach(d=>{
        const maxX = 10 + md;
        if (d.x > maxX) { d.x = maxX; d.el.style.left = d.x + 'px'; }
      });
    });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if (e.key === ' '){
        e.preventDefault();
        if (running) pauseRace(); else startRace();
      }else if (e.key.toLowerCase() === 'r'){
        e.preventDefault(); resetRace();
      }else if (e.key === 'Escape'){
        hideModal();
      }
    });

    // Init
    buildTracks();
  })();
  </script>
</body>
</html>
